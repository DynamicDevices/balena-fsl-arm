From 7ce653bc5b9d80a2ae4b642e57d0e564cc7304b8 Mon Sep 17 00:00:00 2001
From: Alexandru Costache <alexandru@balena.io>
Date: Mon, 27 Apr 2020 10:53:00 +0200
Subject: [PATCH] nitrogen8mm-dwe-1g: Use BalenaOS configs

Integrate the 1G RAM version with BalenaOS.

We also dropped cmd_custom env var that set ram
from cmdline because that is not present in the new
uboot that came with the board and should
of course not be necessary anymore.

Upstream-status: Inappropriate [configuration]
Signed-off-by: Alexandru Costache <alexandru@balena.io>
---
 configs/dwe_1gch1_defconfig | 6 ++++++
 include/configs/dwe.h       | 4 +---
 2 files changed, 7 insertions(+), 3 deletions(-)

diff --git a/configs/dwe_1gch1_defconfig b/configs/dwe_1gch1_defconfig
index 7f9cd42959..531fbe4273 100644
--- a/configs/dwe_1gch1_defconfig
+++ b/configs/dwe_1gch1_defconfig
@@ -103,3 +103,9 @@ CONFIG_USB_ETH_CDC=y
 CONFIG_USBNET_DEVADDR="00:19:b8:00:00:02"
 CONFIG_USBNET_HOST_ADDR="00:19:b8:00:00:01"
 CONFIG_USB_HOST_ETHER=y
+CONFIG_FAT_WRITE=y
+CONFIG_ENV_IS_NOWHERE=y
+CONFIG_CMD_SAVEENV=n
+CONFIG_FAT_WRITE=y
+CONFIG_CMD_EXPORTENV=y
+CONFIG_CMD_IMPORTENV=y
diff --git a/include/configs/dwe.h b/include/configs/dwe.h
index f5bed34abf..a81654fd75 100644
--- a/include/configs/dwe.h
+++ b/include/configs/dwe.h
@@ -59,8 +59,6 @@
 /* Flat Device Tree Definitions */
 #define CONFIG_OF_BOARD_SETUP
 
-#undef CONFIG_CMD_EXPORTENV
-#undef CONFIG_CMD_IMPORTENV
 #undef CONFIG_CMD_IMLS
 
 #undef CONFIG_CMD_CRC32
@@ -96,7 +94,7 @@
         (CONFIG_SYS_INIT_RAM_ADDR + CONFIG_SYS_INIT_SP_OFFSET)
 
 #define CONFIG_ENV_OVERWRITE
-#define CONFIG_ENV_SIZE			0x2000
+#define CONFIG_ENV_SIZE			0x3000
 #if defined(CONFIG_ENV_IS_IN_MMC)
 #define CONFIG_ENV_OFFSET               (-CONFIG_ENV_SIZE)
 #define CONFIG_SYS_MMC_ENV_DEV		0	/* USDHC1 */
-- 
2.17.1

